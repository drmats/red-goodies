<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>action.ts - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-redux.html">redux</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~actionCreators">actionCreators</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~bindActionCreator">bindActionCreator</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~bindActionCreators">bindActionCreators</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~bindActionCreatorsTree">bindActionCreatorsTree</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~createReducer">createReducer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~defineActionCreator">defineActionCreator</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~emptyActionCreators">emptyActionCreators</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~isNumberActionType">isNumberActionType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~isStringActionType">isStringActionType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~isWithPayload">isWithPayload</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~payloadActionCreators">payloadActionCreators</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-redux.html#~sliceReducer">sliceReducer</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">action.ts</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Redux action tools.
 *
 * @module redux
 * @license Apache-2.0
 * @author drmats
 */

/* eslint-disable @typescript-eslint/no-explicit-any */




import type {
    AllowSubset,
    Arr,
    Fun,
    NonConstEnum,
    Override,
    SafeKey,
} from "@xcmats/js-toolbox/type";
import { objectMap } from "@xcmats/js-toolbox/struct";




/**
 * redux-compatible Action interface.
 */
export interface ReduxCompatAction&lt;ActionType = any> {
    type: ActionType;
}




/**
 * redux-compatible AnyAction interface.
 */
export interface ReduxCompatAnyAction&lt;
    ActionType = any,
> extends ReduxCompatAction&lt;ActionType> {
    [key: string]: any;
}




/**
 * Unique, private identifier distinguishing
 * between EmptyAction and PayloadAction (statically and in runtime).
 */
const payload = Symbol("payload");




/**
 * Empty action consists just of { type: ActionType } field.
 */
export interface EmptyAction&lt;
    ActionType extends SafeKey = SafeKey,
> extends ReduxCompatAction&lt;ActionType> {
    [payload]: false;
}




/**
 * Action with payload: { type: ActionType, payload: PayloadType }
 */
export interface PayloadAction&lt;
    PayloadType = any,
    ActionType extends SafeKey = SafeKey,
> extends ReduxCompatAction&lt;ActionType> {
    [payload]: true;
    payload: PayloadType;
}




/**
 * Empty action or action carrying payload.
 */
export type Action&lt;
    PayloadType = any,
    ActionType extends SafeKey = SafeKey,
> =
    | EmptyAction&lt;ActionType>
    | PayloadAction&lt;PayloadType, ActionType>;




/**
 * Type predicate - does a given action carry payload?
 */
export function isWithPayload&lt;PayloadType, ActionType extends SafeKey> (
    a: Action&lt;PayloadType, ActionType>,
): a is PayloadAction&lt;PayloadType, ActionType> {
    return a[payload];
}




/**
 * Type predicate - is a given action of string type?
 */
export function isStringActionType&lt;PayloadType> (
    a: Action&lt;PayloadType>,
): a is Action&lt;PayloadType, string> {
    return typeof a.type === "string";
}




/**
 * Type predicate - is a given action of number type?
 */
export function isNumberActionType&lt;PayloadType> (
    a: Action&lt;PayloadType>,
): a is Action&lt;PayloadType, number> {
    return typeof a.type === "number";
}




/**
 * Action creator not carrying anything else than just `type` field.
 */
export interface EmptyActionCreator&lt;
    ActionType extends SafeKey,
> extends EmptyAction&lt;ActionType> {
    (): EmptyAction&lt;ActionType>;
}




/**
 * Action creator carrying payload (more than just `type`).
 */
export interface PayloadActionCreator&lt;
    PayloadType = any,
    ActionType extends SafeKey = SafeKey,
    Args extends Arr = Arr,
> extends EmptyAction&lt;ActionType> {
    (...args: Args): PayloadAction&lt;PayloadType, ActionType>;
}




/**
 * Any action creator (carrying just `type` or `type` and `payload`).
 */
export interface ActionCreator&lt;
    PayloadType = any,
    ActionType extends SafeKey = SafeKey,
    Args extends Arr = Arr,
> extends EmptyAction&lt;ActionType> {
    (...args: Args): Action&lt;PayloadType, ActionType>;
}




/**
 * Redux action creator definer.
 *
 * @function defineActionCreator
 * @param actionType Action type
 * @param creator Optional custom function returning payload.
 * @returns Action creator function.
 */
export function defineActionCreator&lt;
    ActionType extends SafeKey,
> (actionType: ActionType):
    EmptyActionCreator&lt;ActionType>;
export function defineActionCreator&lt;
    ActionType extends SafeKey,
    PayloadType,
    Args extends Arr,
> (actionType: ActionType, creator?: Fun&lt;Args, PayloadType>):
    PayloadActionCreator&lt;PayloadType, ActionType, Args>;
export function defineActionCreator&lt;
    ActionType extends SafeKey,
    PayloadType,
    Args extends Arr,
> (actionType: ActionType, creator?: Fun&lt;Args, PayloadType>):
    ActionCreator&lt;PayloadType, ActionType, Args> {
    let actionCreator: any = !creator ?
        () => ({
            type: actionType,
            [payload]: false,
        }) :
        (...args: Args) => ({
            type: actionType,
            [payload]: true,
            payload: creator(...args),
        });
    actionCreator.type = actionType;
    return actionCreator;
}




/**
 * Construct interface based on `ActionEnum`. Consist of empty action
 * creators (action creators without payload - just `type` field).
 */
export type EmptyActionCreators&lt;ActionEnum extends NonConstEnum> = {
    [K in keyof ActionEnum]: EmptyActionCreator&lt;ActionEnum[K]>;
};




/**
 * Construct object whose keys correspond to `actionEnum` keys and
 * values consists of empty action creators for each type. Conforms to
 * `EmptyActionCreators&lt;ActionEnum>` interface.
 *
 * @function emptyActionCreators
 * @param actionEnum Enum upon which an EmptyActionCreators object is built.
 * @returns EmptyActionCreators object.
 */
export function emptyActionCreators&lt;ActionEnum extends NonConstEnum> (
    actionEnum: ActionEnum,
): EmptyActionCreators&lt;ActionEnum> {
    let actions = {} as EmptyActionCreators&lt;ActionEnum>;
    for (const actionType in actionEnum) {
        actions[actionType] = defineActionCreator(actionEnum[actionType]);
    }
    return actions;
}




/**
 * Take `ActionEnum` type with `PayloadCreators` object type and construct
 * `PayloadActionCreators` on its basis.
 *
 * Constructed `PayloadActionCreators` object type consists only of keys
 * that are also present in `ActionEnum` type (all other keys are dropped).
 */
export type PayloadActionCreators&lt;
    ActionEnum extends NonConstEnum,
    PayloadCreators,
> = {
    [K in Extract&lt;keyof PayloadCreators, keyof ActionEnum>]:
        PayloadCreators[K] extends Fun&lt;infer Args, infer PayloadType> ?
            PayloadActionCreator&lt;PayloadType, ActionEnum[K], Args> : never;
};




/**
 * Take empty action creators object based on `ActionEnum` type
 * (an object with all action creators not carrying anything besides
 * `type` property) and `PayloadCreators` object consisting of plain
 * javascript functions taking arguments and returning values.
 *
 * `PayloadCreators` object type is constrained to be a subset of `ActionEnum`
 * type (in the sense of `AllowSubset` type defined in `type/utils.ts`).
 *
 * Create fully typed action creators object with all action creators
 * defined as `EmptyActionCreator` or `PayloadActionCreator`.
 *
 * @function payloadActionCreators
 * @param emptyActionCreators EmptyActionCreators object
 * @param payloadCreators Object with payload creators.
 * @returns ActionCreators object.
 */
export function payloadActionCreators&lt;
    ActionEnum extends NonConstEnum,
    PayloadCreators extends
        &amp; AllowSubset&lt;ActionEnum, PayloadCreators>
        &amp; Partial&lt;Record&lt;keyof ActionEnum, Fun>>,
> (
    emptyActionCreators: EmptyActionCreators&lt;ActionEnum>,
    payloadCreators: PayloadCreators,
):
    Override&lt;
        typeof emptyActionCreators,
        PayloadActionCreators&lt;ActionEnum, PayloadCreators>
    >
{
    return Object.assign(
        emptyActionCreators,
        objectMap(payloadCreators) &lt;keyof ActionEnum>(([key, creator]) => [
            key, defineActionCreator(emptyActionCreators[key].type, creator),
        ]),
    );
}




/**
 * Construct action slice for provided action enum. Optionally
 * define action creators with payload. Statically typed.
 *
 * @function actionCreators
 * @param actionEnum Enum upon which an ActionCreators object is built.
 * @param payloadCreators Optional object with payload creators.
 * @returns ActionCreators object.
 */
export function actionCreators&lt;
    ActionEnum extends NonConstEnum,
> (actionEnum: ActionEnum): EmptyActionCreators&lt;ActionEnum>;
export function actionCreators&lt;
    ActionEnum extends NonConstEnum,
    PayloadCreators extends
        &amp; AllowSubset&lt;ActionEnum, PayloadCreators>
        &amp; Partial&lt;Record&lt;keyof ActionEnum, Fun>>,
> (
    actionEnum: ActionEnum,
    payloadCreators?: PayloadCreators,
):
    Override&lt;
        EmptyActionCreators&lt;ActionEnum>,
        PayloadActionCreators&lt;ActionEnum, PayloadCreators>
    >;
export function actionCreators&lt;
    ActionEnum extends NonConstEnum,
    PayloadCreators extends
        &amp; AllowSubset&lt;ActionEnum, PayloadCreators>
        &amp; Partial&lt;Record&lt;keyof ActionEnum, Fun>>,
> (
    actionEnum: ActionEnum,
    payloadCreators?: PayloadCreators,
):
    | EmptyActionCreators&lt;ActionEnum>
    | Override&lt;
        EmptyActionCreators&lt;ActionEnum>,
        PayloadActionCreators&lt;ActionEnum, PayloadCreators>
    >
{
    const eac = emptyActionCreators(actionEnum);
    if (payloadCreators) {
        return payloadActionCreators(eac, payloadCreators);
    } else {
        return eac;
    }
}




/**
 * Binds given action creator with chosen store's dispatch.
 *
 * @function bindActionCreator
 * @param actionCreator any action creator
 * @param dispatch redux store's `dispatch` function
 * @returns bound action creator
 */
export function bindActionCreator&lt;
    ActionCreatorType extends Fun,
    ReduxDispatch extends Fun&lt;[Action]>,
> (
    actionCreator: ActionCreatorType | ActionCreator,
    dispatch: ReduxDispatch,
): typeof actionCreator {
    let boundActionCreator = (
        ...args: Parameters&lt;ActionCreatorType>
    ) => dispatch(actionCreator(...args));
    if ((actionCreator as ActionCreator).type) {
        (boundActionCreator as ActionCreator).type =
            (actionCreator as ActionCreator).type;
    }
    return boundActionCreator as ActionCreatorType;
}




/**
 * Redux's original `bindActionCreators` clone with extended `Action`
 * support (original function assumes dispatch parametrized with redux's
 * `AnyAction` which is not compatible with `Action`).
 *
 * Turns an object with action creators into an object with every
 * action creator wrapped into a `dispatch` call.
 *
 * @function bindActionCreators
 * @param actionCreators Object with action creator functions
 * @param dispatch redux store's `dispatch` function
 * @returns Object with wrapped action creators
 */
export function bindActionCreators&lt;
    ActionCreatorType extends Fun,
    ReduxDispatch extends Fun&lt;[Action]>,
    ActionCreators extends Record&lt;SafeKey, ActionCreatorType | ActionCreator>,
> (
    actionCreators: ActionCreators,
    dispatch: ReduxDispatch,
): typeof actionCreators {
    return (
        objectMap(actionCreators) (
            ([k, a]) => [k, bindActionCreator(a, dispatch)],
        )
    ) as unknown as ActionCreators;
}




/**
 * Bind whole tree of action creators to the redux's dispatch function.
 *
 * @function bindActionCreatorsTree
 * @param acTree Object with `actionCreators` objects
 * @param dispatch redux store's `dispatch` function
 * @returns Object with wrapped action creators
 */
export function bindActionCreatorsTree&lt;
    ActionCreatorType extends Fun,
    ReduxDispatch extends Fun&lt;[Action]>,
    ActionCreators extends Record&lt;SafeKey, ActionCreatorType | ActionCreator>,
    ACTree extends Record&lt;keyof ACTree, ActionCreators>,
> (
    acTree: ACTree,
    dispatch: ReduxDispatch,
): ACTree {
    return objectMap(acTree) (
        ([k, a]) => [k, bindActionCreators(a, dispatch)],
    ) as ACTree;
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Wed Feb 10 2021 10:23:00 GMT+0100 (Central European Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
